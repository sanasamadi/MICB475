library(phyloseq)
library(ape)
library(tidyverse)

#Load data
meta <- read.delim("colombia_metadata.txt")

#Filter data
meta_filtered <- select(meta, c(BMI, waist_circumference, Body_Fat_Percentage))

# Sample data for demonstration purposes
Individuals <- data.frame(meta_filtered)


# Initialize an empty vector to store the filtered indices
filtered_indices <- c()

# Loop through each row of the data frame
for (i in 1:nrow(Individuals)) {
  row <- Individuals[i,]
  
  # Check if the row meets all three thresholds or if it's below all three thresholds
  if ((row$BMI >= 30 & ((row$gender == "male" & row$Body_Fat_Percentage >= 25) | 
                        (row$gender == "female" & row$Body_Fat_Percentage >= 30)) & 
                        row$waist_circumference >= 90) |
      (row$BMI < 30 & ((row$gender == "male" & row$Body_Fat_Fercentage < 25) | 
                       (row$gender == "female" & row$Body_Fat_Percentage < 30)) & 
                       row$waist_circumference < 90)) {
    filtered_indices <- c(filtered_indices, i)
  }
}

# Subset the data frame to include only the filtered rows
filtered_Individuals <- Individuals[filtered_indices,]

# Read in the filtered participant data (assuming it's stored in a CSV file named "filtered_participants.csv")
filtered_participants <- read.csv("filtered_participants.csv")

# Extract the columns with the relevant data (assuming the columns are named "BMI", "body_fat_percentage", and "waist_circumference")
bmi <- filtered_participants$BMI
body_fat_percentage <- filtered_participants$body_fat_percentage
waist_circumference <- filtered_participants$waist_circumference

# Combine the data into a matrix format
data_matrix <- cbind(bmi, body_fat_percentage, waist_circumference)

# Compute the Bray-Curtis dissimilarity matrix using vegan package
bc_dissimilarity <- vegdist(data_matrix, method = "bray")

# Visualize the dissimilarity matrix using a dendrogram
dendrogram <- hclust(bc_dissimilarity, method = "average")
plot(dendrogram)
